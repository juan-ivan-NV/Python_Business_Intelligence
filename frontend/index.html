<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <script src='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css' rel='stylesheet' />
  <script src='https://api.mapbox.com/mapbox.js/v3.3.0/mapbox.js'></script>
  <link href='https://api.mapbox.com/mapbox.js/v3.3.0/mapbox.css' rel='stylesheet' />
</head>

<body>
  <h1>MAPA</h1>
  <div id='map' style='width: 1000px; height: 800px;'></div>


  <script>
    L.mapbox.accessToken = 'pk.eyJ1IjoiZGFuaWVsaXNsYXMzIiwiYSI6ImNrOTU4ZG03djBsMWYzbnFoMGxvaWNicWcifQ.6RYPn_Wv4g1zBpKNm9Xd5w';
    let url = 'http://localhost:4000/api/business';
    const index = 1

    const geojson = []
    function buildings3d() {
      // Insert the layer beneath any symbol layer.
      var layers = map.getStyle().layers;

      var labelLayerId;
      for (var i = 0; i < layers.length; i++) {
        if (layers[i].type === 'symbol' && layers[i].layout['text-field']) {
          labelLayerId = layers[i].id;
          break;
        }
      }

      map.addLayer(
        {
          'id': '3d-buildings',
          'source': 'composite',
          'source-layer': 'building',
          'filter': ['==', 'extrude', 'true'],
          'type': 'fill-extrusion',
          'minzoom': 15,
          'paint': {
            'fill-extrusion-color': '#aaa',

            // use an 'interpolate' expression to add a smooth transition effect to the
            // buildings as the user zooms in
            'fill-extrusion-height': [
              'interpolate',
              ['linear'],
              ['zoom'],
              15,
              0,
              15.05,
              ['get', 'height']
            ],
            'fill-extrusion-base': [
              'interpolate',
              ['linear'],
              ['zoom'],
              15,
              0,
              15.05,
              ['get', 'min_height']
            ],
            'fill-extrusion-opacity': 0.6
          }
        },
        labelLayerId
      );

    }

    fetch(url)
      .then(res => res.json())
      .then((data) => {
        data.office.forEach(office => {
          geojson.push({
            type: "Feature",
            geometry: {
              type: "Point",
              coordinates: [office.lng, office.lat]
            }
          })

        })


      })
      .catch(err => { throw err });

    mapboxgl.accessToken = 'pk.eyJ1IjoiZGFuaWVsaXNsYXMzIiwiYSI6ImNrOTU4ZG03djBsMWYzbnFoMGxvaWNicWcifQ.6RYPn_Wv4g1zBpKNm9Xd5w';

    setTimeout(() => {
     /*
      var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v10',
        zoom: 14,
        pitch: 45,
        bearing: -10,
        antialias: true,
        center: [cordenadas.lng, cordenadas.lat]
      })
      const marker = new mapboxgl.Marker({
        color: 'red'
      })
        .setLngLat([cordenadas.lng, cordenadas.lat])
        .addTo(map)
      function puntos() {
        map.addSource('offices-points', {
          'type': 'geojson',
          'data': {
            'type': 'FeatureCollection',
            'features': geojson
          }
        });
      }
      map.on('load', buildings3d);
*/
var mapGeo = L.mapbox.map('map')
  .setView([37.8, -96], 4)
  .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/light-v10')).addLayer(
    
  )
  
var myLayer = L.mapbox.featureLayer().setGeoJSON(geojson).addTo(mapGeo);
mapGeo.scrollWheelZoom.disable();
    }, 2000)

  </script>
</body>

</html>